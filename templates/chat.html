<link href="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
<script src="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

<!DOCTYPE html>
<html>
	<head>
		<title>MedAssist Pro</title>
		<script>
			function toggleDarkMode() {
				document.body.classList.toggle('dark-mode');
			}
		</script>
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css')}}"/>
	</head>
	
	
	<body>
		<button onclick="toggleDarkMode()" id="darkModeBtn" class="btn btn-secondary fancy-toggle" style="position:fixed;top:10px;right:10px;z-index:1000;border-radius:50%;width:56px;height:56px;display:flex;align-items:center;justify-content:center;font-size:1.5rem;box-shadow:0 4px 16px rgba(0,0,0,0.15);transition:background 0.3s, box-shadow 0.3s;">
			<span id="darkModeIcon" style="transition:transform 0.5s;display:inline-block;">üåô</span>
		</button>
		<div id="animated-bg">
			<canvas id="particles"></canvas>
		</div>
		<div class="container-fluid h-100">
			<div class="row justify-content-center h-100">
				<div class="col-md-8 col-xl-6 chat">
					<div class="card glass-card">
						<div class="card-header msg_head">
							<div class="d-flex bd-highlight">
								<div class="img_cont">
									<img src="/static/bot_image.png" class="rounded-circle user_img">
									<span class="online_icon"></span>
								</div>
								<div class="user_info">
									<span>MedAssist Pro</span>
									<p>Your professional virtual health assistant.</p>
								</div>
							</div>
						</div>
						<div id="messageFormeight" class="card-body msg_card_body"></div>
						<div class="card-footer">
							<form id="messageArea" class="input-group">
								<input type="text" id="text" name="msg" placeholder="Type your message..." autocomplete="off" class="form-control type_msg" required/>
								<div class="input-group-append">
									<button type="submit" id="send" class="input-group-text send_btn"><i class="fas fa-location-arrow"></i></button>
								</div>
							</form>
						</div>
					</div>
				</div>
			</div>
		</div>
		<script>
			$(document).ready(function() {
				$("#messageArea").on("submit", function(event) {
					const date = new Date();
					const hour = date.getHours();
					const minute = date.getMinutes();
					const str_time = hour+":"+minute;
					var rawText = $("#text").val();

					var userHtml = '<div class="d-flex justify-content-end mb-4"><div class="img_cont_msg"><img src="/static/user_profile.png" class="rounded-circle user_img_msg"></div><div class="msg_cotainer_send user_bubble">' + rawText + '<span class="msg_time_send">'+ str_time + '</span></div></div>';
					$("#text").val("");
					$("#messageFormeight").append(userHtml);
					// Show loading spinner
					var loadingHtml = '<div class="d-flex justify-content-start mb-4" id="loadingSpinner"><div class="img_cont_msg"><img src="/static/bot_image.png" class="rounded-circle user_img_msg"></div><div class="msg_cotainer assistant_bubble"><span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> <span class="msg_time">' + str_time + '</span></div></div>';
					$("#messageFormeight").append(loadingHtml);
					$.ajax({
						data: {
							msg: rawText,  
						},
						type: "POST",
						url: "/get",
					}).done(function(data) {
						$("#loadingSpinner").remove();
						var botHtml = '<div class="d-flex justify-content-start mb-4"><div class="img_cont_msg"><img src="/static/bot_image.png" class="rounded-circle user_img_msg"></div><div class="msg_cotainer assistant_bubble">' + data + '<span class="msg_time">' + str_time + '</span></div></div>';
						$("#messageFormeight").append($.parseHTML(botHtml));
					}).fail(function(jqXHR, textStatus, errorThrown) {
						$("#loadingSpinner").remove();
						var errorHtml = '<div class="d-flex justify-content-start mb-4"><div class="img_cont_msg"><img src="/static/bot_image.png" class="rounded-circle user_img_msg"></div><div class="msg_cotainer assistant_bubble text-danger">Error: Unable to get response. Please try again.<span class="msg_time">' + str_time + '</span></div></div>';
						$("#messageFormeight").append($.parseHTML(errorHtml));
					});
					event.preventDefault();
				});
			});
		// Simple animated particles background
		window.onload = function() {
			var canvas = document.getElementById('particles');
			if (!canvas) return;
			var ctx = canvas.getContext('2d');
			var w = window.innerWidth, h = window.innerHeight;
			canvas.width = w; canvas.height = h;
			var particles = [];
			for (var i = 0; i < 50; i++) {
				particles.push({
					x: Math.random() * w,
					y: Math.random() * h,
					r: Math.random() * 2 + 1,
					dx: (Math.random() - 0.5) * 0.5,
					dy: (Math.random() - 0.5) * 0.5
				});
			}
			function draw() {
				ctx.clearRect(0, 0, w, h);
				for (var i = 0; i < particles.length; i++) {
					var p = particles[i];
					ctx.beginPath();
					ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
					ctx.fillStyle = 'rgba(255,255,255,0.15)';
					ctx.fill();
					p.x += p.dx; p.y += p.dy;
					if (p.x < 0 || p.x > w) p.dx *= -1;
					if (p.y < 0 || p.y > h) p.dy *= -1;
				}
				requestAnimationFrame(draw);
			}
			draw();
		}
		<script>
			// Medical-themed background animation logic
			function setMedicalBackground(isDark) {
				const canvas = document.getElementById('particles');
				if (!canvas) return;
				const ctx = canvas.getContext('2d');
				const w = window.innerWidth, h = window.innerHeight;
				canvas.width = w; canvas.height = h;
				ctx.clearRect(0, 0, w, h);
				let icons = [];
				// Choose icons and colors based on theme
				if (isDark) {
					icons = ['üíâ','ü©∫','üß¨','ü©∏','üßë‚Äç‚öïÔ∏è'];
				} else {
					icons = ['üíä','ü©∫','üßë‚Äç‚öïÔ∏è','üß¨','ü¶†'];
				}
				let particles = [];
				for (let i = 0; i < 30; i++) {
					particles.push({
						x: Math.random() * w,
						y: Math.random() * h,
						icon: icons[Math.floor(Math.random()*icons.length)],
						size: Math.random() * 32 + 24,
						dx: (Math.random() - 0.5) * 0.7,
						dy: (Math.random() - 0.5) * 0.7,
						rotate: Math.random() * 360
					});
				}
				function draw() {
					ctx.clearRect(0, 0, w, h);
					for (let p of particles) {
						ctx.save();
						ctx.font = `${p.size}px serif`;
						ctx.globalAlpha = isDark ? 0.18 : 0.13;
						ctx.translate(p.x, p.y);
						ctx.rotate(p.rotate * Math.PI / 180);
						ctx.fillText(p.icon, 0, 0);
						ctx.restore();
						p.x += p.dx; p.y += p.dy; p.rotate += 0.2;
						if (p.x < 0 || p.x > w) p.dx *= -1;
						if (p.y < 0 || p.y > h) p.dy *= -1;
					}
					requestAnimationFrame(draw);
				}
				draw();
			}

			// Persist theme using localStorage
			function setTheme(isDark) {
				if(isDark) {
					document.body.classList.add('dark-mode');
					document.getElementById('darkModeIcon').textContent = '‚òÄÔ∏è';
					document.body.style.background = '#181a20';
				} else {
					document.body.classList.remove('dark-mode');
					document.getElementById('darkModeIcon').textContent = 'üåô';
					document.body.style.background = '#fff';
				}
				setMedicalBackground(isDark);
			}

			function toggleDarkMode() {
				const isDark = !document.body.classList.contains('dark-mode');
				setTheme(isDark);
				// Animate icon rotation
				const icon = document.getElementById('darkModeIcon');
				if(isDark) {
					icon.style.transform = 'rotate(360deg) scale(1.2)';
				} else {
					icon.style.transform = 'rotate(-360deg) scale(1)';
				}
				setTimeout(() => { icon.style.transform = ''; }, 500);
				localStorage.setItem('theme', isDark ? 'dark' : 'light');
			}

			// On page load, set theme from localStorage
			window.addEventListener('DOMContentLoaded', function() {
				const theme = localStorage.getItem('theme');
				setTheme(theme === 'dark');
			});
		</script>